<div class="technique-view view-page grid spacing-12">
    <div class="row">
        <!-- NAME -->
        <div class="col">
            <h1>{{technique.name}}</h1>
            <app-subheading [config]="config" (onOpenHistory)="openHistory()" (onOpenNotes)="openNotes()"></app-subheading>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <!-- ATT&CK ID -->
            <app-attackid-property class="grow-to-row" [config]="{
                mode: editing? 'edit' : 'view',
                object: technique
            }"></app-attackid-property>
        </div>
        <div class="col">
            <!-- VERSION NUMBER -->
            <app-version-property class="grow-to-row" [config]="{
                mode: editing? 'edit' : 'view',
                object: technique
            }"></app-version-property>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <div class="labelled-box grow-to-row">
                <!-- TYPE -->
                <div class="content">
                    {{technique.is_subtechnique ? "Sub-technique": "Technique"}}
                </div>
                <label>type</label>
            </div>
        </div>
        <div class="col">
            <!-- PLATFORMS -->
            <app-list-property class="grow-to-row" [config]="{
                mode: editing? 'edit': 'view',
                object: technique,
                field: 'platforms',
                editType: 'select'
            }"></app-list-property>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <!-- DESCRIPTION -->
            <app-descriptive-property [config]="{
                mode: 'view',
                object: technique,
                field: 'description',
                firstParagraphOnly: false, 
                referencesField: technique.external_references,
                label: 'description'
            }"></app-descriptive-property>
        </div>
    </div>
    <!-- DOMAIN SPECIFIC FIELDS -->
    <div *ngIf="technique.domains.length > 0 || editing" class="row">
        <div class="col">
            <app-list-property class="grow-to-row" [config]="{
                mode: editing? 'edit': 'view',
                object: technique,
                field: 'domains',
                editType: 'select'
            }"></app-list-property>
        </div>
        <ng-container *ngIf="showDomainField('enterprise-attack', 'data_sources') || showDomainField('enterprise-attack', 'system_requirements') || showDomainField('mobile-attack', 'tactic_type')">
            <!-- Display only if domain specific fields exist or if in 'edit' mode -->
            <div class="col arrow">
                <mat-icon>arrow_forward</mat-icon>
            </div>
            <div class="col">
                <!-- DATA SOURCES -->
                <div *ngIf="showDomainField('enterprise-attack', 'data_sources')" class="row">
                    <app-list-property class="grow-to-row" [config]="{
                        mode: editing? 'edit': 'view',
                        object: technique,
                        field: 'data_sources',
                        label: 'data sources',
                        editType: 'any'
                    }"></app-list-property>
                </div>
                <!-- SYSTEM REQUIREMENTS -->
                <div *ngIf="showDomainField('enterprise-attack', 'system_requirements')" class="row">
                    <app-list-property class="grow-to-row" [config]="{
                        mode: editing? 'edit': 'view',
                        object: technique,
                        field: 'system_requirements',
                        label: 'system requirements',
                        editType: 'any'
                    }"></app-list-property>
                </div>
                <!-- TACTIC TYPES -->
                <div *ngIf="showDomainField('mobile-attack', 'tactic_type')" class="row">
                    <app-list-property class="grow-to-row" [config]="{
                        mode: editing? 'edit': 'view',
                        object: technique,
                        field: 'tactic_type',
                        editType: 'select'
                    }"></app-list-property>
                </div>
            </div>
        </ng-container>
    </div>
    <!-- TACTIC SPECIFIC FIELDS -->
    <div *ngIf="technique.tactics.length > 0 || editing" class="row">
        <div class="col">
            <app-list-property class="grow-to-row" [config]="{
                mode: editing? 'edit': 'view',
                object: technique,
                field: 'tactics',
                editType: 'stixList'
            }"></app-list-property>
        </div>
        <ng-container *ngIf="showTacticField('privilege-escalation', 'permissions_required') || showTacticField('privilege-escalation', 'effective_permissions')
                            || showTacticField('impact', 'impact_type') || showTacticField('defense-evasion', 'defense_bypassed') || technique.tactics.includes('execution')">
            <!-- Display only if tactic specific fields exist -->
            <div class="col arrow">
                <mat-icon>arrow_forward</mat-icon>
            </div>
            <div class="col">
                <!-- PERMISSIONS REQUIRED -->
                <div *ngIf="showTacticField('privilege-escalation', 'permissions_required')" class="row">
                    <app-list-property class="grow-to-row" [config]="{
                        mode: editing? 'edit': 'view',
                        object: technique,
                        field: 'permissions_required',
                        label: 'permissions required',
                        editType: 'select'
                    }"></app-list-property>
                </div>
                <!-- EFFECTIVE PERMISSIONS -->
                <div *ngIf="showTacticField('privilege-escalation', 'effective_permissions')" class="row">
                    <app-list-property class="grow-to-row" [config]="{
                        mode: editing? 'edit': 'view',
                        object: technique,
                        field: 'effective_permissions',
                        label: 'effective permissions',
                        editType: 'select'
                    }"></app-list-property>
                </div>
                <!-- IMPACT TYPE -->
                <div *ngIf="showTacticField('impact', 'impact_type')" class="row">
                    <app-list-property class="grow-to-row" [config]="{
                        mode: editing? 'edit': 'view',
                        object: technique,
                        field: 'impact_type',
                        label: 'impact type',
                        editType: 'select'
                    }"></app-list-property>
                </div>
                <!-- DEFENSE BYPASSED -->
                <div *ngIf="showTacticField('defense-evasion', 'defense_bypassed')" class="row">
                    <app-list-property class="grow-to-row" [config]="{
                        mode: editing? 'edit': 'view',
                        object: technique,
                        field: 'defense_bypassed',
                        label: 'defenses bypassed',
                        editType: 'any'
                    }"></app-list-property>
                </div>
                <!-- REMOTE SUPPORT -->
                <div *ngIf="technique.tactics.includes('execution')" class="row">
                    <div class="labelled-box grow-to-row">
                        <div class="content no-label">
                            <mat-checkbox [checked]="technique.remote_support" disabled>
                                Remote Support?
                            </mat-checkbox>
                        </div>
                    </div>
                </div>
            </div>
        </ng-container>
    </div>
    <!-- RELATIONSHIPS -->
    <div *ngIf="config.showRelationships || !config.hasOwnProperty('showRelationships')">
        <!-- SUBTECHNIQUES -->
        <div *ngIf="!technique.is_subtechnique">
            <div class="row">
                <div class="col">
                    <h2 class="section-header">Sub-techniques</h2>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <app-stix-list [config]="{
                        'type': 'relationship', 
                        'targetRef': technique.stixID,
                        'relationshipType': 'subtechnique-of',
                        'clickBehavior': 'dialog'
                    }"></app-stix-list>
                </div>
            </div>
        </div>
        <!-- MITIGATIONS -->
        <div class="row">
            <div class="col">
                <h2 class="section-header">Mitigations</h2>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <app-stix-list [config]="{
                    'type': 'relationship',
                    'targetRef': technique.stixID,
                    'relationshipType': 'mitigates',
                    'clickBehavior': 'dialog'
                }"></app-stix-list>
            </div>
        </div>
        <!-- GROUPS -->
        <div class="row">
            <div class="col">
                <h2 class="section-header">Procedure Examples</h2>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <app-stix-list [config]="{
                    'type': 'relationship',
                    'targetRef': technique.stixID,
                    'relationshipType': 'uses',
                    'clickBehavior': 'dialog'
                }"></app-stix-list>
            </div>
        </div>
    </div>
    <!-- EXTERNAL REFERENCES -->
    <div *ngIf="technique.external_references.list().length > 0">
        <div class="row">
            <div class="col">
                <h2 class="section-header">References</h2>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <app-external-references-property [config]="{
                    mode: 'view',
                    object: technique,
                    referencesField: technique.external_references
                }"></app-external-references-property>
            </div>
        </div>
    </div>
</div>